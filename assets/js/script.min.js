document.addEventListener("DOMContentLoaded", function () {

    // External links open in a new tab
    document.querySelectorAll("a").forEach(function (link) {
        if (link.href.indexOf(location.hostname) === -1) {
            link.target = "_blank";
        }
    });

    // Dropdown functionality for sidebar
    var dropdownTriggers = document.querySelectorAll(".sidebar .dropdown-trigger");
    dropdownTriggers.forEach(function (trigger) {
        trigger.addEventListener("click", function () {
            var dropdownContent = trigger.parentElement.querySelector(".dropdown-mobile");
            trigger.parentElement.querySelector(".fa-caret-down").classList.toggle("rotate-icon");
            dropdownContent.classList.toggle("display-menu");
        });
    });

    // Function to scroll to the top of the page
    function topFunction() {
        document.body.scrollTop = 0; // For Safari
        document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }

    // Search functionality
    var searchLabel = document.querySelector("#search-label"),
        searchBox = document.querySelector(".search-box"),
        searchContainer = document.querySelector("#search-container"),
        closeSearch = document.querySelector(".close-search");

    if (searchLabel && closeSearch) {
        searchLabel.addEventListener("click", function () {
            searchContainer.style.display = "block";
            searchBox.focus();
        });

        closeSearch.addEventListener("click", function () {
            searchContainer.style.display = "none";
        });
    }

    // Sidebar toggle functionality
    var sidebar = document.getElementById("sidebar"),
        sidebarOverlay = document.querySelector(".sidebar-overlay"),
        sidebarBtnClose = document.getElementById("sidebarBtnClose"),
        sidebarBtnOpen = document.getElementById("sidebarBtnOpen");

    function openSidebar() {
        sidebarOverlay.style.left = "0";
        sidebar.style.left = "0";
    }

    function closeSidebar(event) {
        if (event) event.stopPropagation();
        sidebarOverlay.style.left = "-100%";
        sidebar.style.left = "-100%";
    }

    if (sidebarOverlay && sidebarBtnClose && sidebarBtnOpen) {
        sidebarOverlay.addEventListener("click", closeSidebar);
        sidebarBtnClose.addEventListener("click", closeSidebar);
        sidebarBtnOpen.addEventListener("click", openSidebar);
    }

    // Scroll to top visibility
    window.onscroll = function () {
        const scrollPos = window.scrollY;

        const move_to_top_button = document.querySelector('.move-to-top');
        if (scrollPos > 150) {
            move_to_top_button.classList.add('d-block')
            move_to_top_button.classList.remove('d-none')

            move_to_top_button.addEventListener('click', function () {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            })

        } else {
            move_to_top_button.classList.remove('d-block')
            move_to_top_button.classList.add('d-none')

        }
    };


    // document.addEventListener('contextmenu', function (e) {
    //     e.preventDefault();
    // });



    jQuery(document).ready(function ($) {
        var galleryCache = {}; // Object to store cached galleries

        // Function to initialize Splide slider
        function initializeSplide() {
            var splide = new Splide('.splide', {
                type: 'loop',
                perPage: 1,
                autoplay: false,
                rewind: true,
                pagination: true,
                arrows: true,
                speed: 850, // Transition speed in milliseconds
                easing: 'ease-out' // Easing function for the animation
            }).mount();

            // Refresh the slider and then make it visible
            $('.splide').css('opacity', '0');
            setTimeout(function () {
                splide.refresh();
                $('.splide').css('opacity', '1');
            }, 100); // Adjust timeout as needed
        }

        // Define other functions and event handlers here
        function openModalAndFetchGallery(postUrl) {
            var $modal = $('#galleryModal');
            var $galleryContainer = $('.splide__list');
            if (galleryCache[postUrl]) {
                $galleryContainer.html(galleryCache[postUrl]);
                initializeSplide();
                $modal.css('display', 'block').css('opacity', '0');
                setTimeout(function () {
                    $modal.css('opacity', '1');
                }, 10); // Short delay before starting the opacity transition
                history.pushState({ modalOpen: true }, '');
            } else {
                $.ajax({
                    url: '/wp-admin/admin-ajax.php',
                    type: 'POST',
                    data: {
                        'action': 'fetch_gallery',
                        'postUrl': postUrl
                    },
                    success: function (response) {
                        if (response.success) {
                            $galleryContainer.html(response.data);
                            galleryCache[postUrl] = response.data;
                            initializeSplide();
                            $modal.css('display', 'block').css('opacity', '0');
                            setTimeout(function () {
                                $modal.css('opacity', '1');
                            }, 10);
                            history.pushState({ modalOpen: true }, '');
                        } else {
                            console.error('Gallery fetch error:', response.data);
                        }
                    },
                    error: function (error) {
                        console.error('AJAX error:', error);
                    }
                });
            }
        }

        $('.gallery-feature-link').click(function (event) {
            event.preventDefault();
            var postUrl = $(this).data('post-url');
            openModalAndFetchGallery(postUrl);
        });

        $('.close-button').click(function () {
            closeModal();
        });

        function closeModal() {
            var $modal = $('#galleryModal');
            $modal.css('opacity', '0');
            setTimeout(function () {
                $modal.css('display', 'none');
                if (history.state && history.state.modalOpen) {
                    history.back();
                }
            }, 300);
        }

        window.addEventListener('popstate', function (event) {
            if ($('#galleryModal').css('display') === 'block') {
                closeModal();
            }
        });
    });


    var mainSliderEl = document.getElementById("slider");
    if (mainSliderEl) {
       
        mainSliderEl.style.display = "", new Splide(".splide", {
            type: 'loop',
            perPage: 1,
            autoplay: false,
            rewind: true,
            pagination: true,
            arrows: true,
            speed: 650, // Transition speed in milliseconds
            easing: 'ease-out' // Easing function for the animation
        }).mount();
    }

});
